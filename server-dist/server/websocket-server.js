#!/usr/bin/env node
"use strict";var __extends=this&&this.__extends||function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();exports.__esModule=true;var websocket_1=require("websocket");var http=require("http");var wolfy87_eventemitter_1=require("wolfy87-eventemitter");var Server=function(_super){__extends(Server,_super);function Server(){var _this=_super.call(this)||this;_this.connected=0;var server=http.createServer(function(request,response){var _a;var url=(_a=request.url)!==null&&_a!==void 0?_a:"url not found";console.log(Date.now()+" Received request for "+url);response.writeHead(404);response.end();});server.listen(8080,function(){var info=server.address();console.log(new Date().toString()+" is listening on "+info.port);});var wsServer=new websocket_1.server({httpServer:server,autoAcceptConnections:false});wsServer.on("request",function(request){var connection=request.accept("",request.origin);var id=_this.connected;_this.connected+=1;console.log("client "+id+" connected");connection.on("message",function(message){var _a;console.log("message");if(message.type==="utf8"){var data=(_a=message.utf8Data)!==null&&_a!==void 0?_a:"";console.log("Received Message: "+data);connection.sendUTF(message.utf8Data);}else if(message.type==="binary"){console.log("Received Binary Message of "+message.binaryData.length+" bytes");connection.sendBytes(message.binaryData);}});connection.on("close",function(reasonCode,description){console.log("client "+id+" disconnected");console.log("close");console.log(new Date()+" Peer "+connection.remoteAddress+" disconnected.");});});return _this;}return Server;}(wolfy87_eventemitter_1["default"]);exports["default"]=Server;